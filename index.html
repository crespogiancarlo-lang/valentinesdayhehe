<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚ù§Ô∏è For You ‚ù§Ô∏è</title>
  <style>
    :root{
      --bg1:#ffe6f0;
      --bg2:#fff7fb;
      --pink:#ff4d88;
      --dark:#2b2b2b;
      --card:#ffffffcc;
      --shadow: 0 10px 30px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--dark);
      background: radial-gradient(circle at top, var(--bg2), var(--bg1));
      overflow:hidden;
    }
    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:min(900px, 94vw);
      background:var(--card);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:28px;
      position:relative;
      backdrop-filter: blur(8px);
    }
    h1{
      margin:0 0 10px 0;
      font-size: clamp(28px, 4vw, 44px);
      color:var(--pink);
    }
    p{
      margin:0 0 18px 0;
      font-size: clamp(16px, 2.2vw, 20px);
      line-height:1.4;
    }
    .center{ text-align:center; }
    .btnRow{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:16px;
      position:relative;
    }
    button{
      border:none;
      border-radius:14px;
      padding:12px 18px;
      font-size:18px;
      cursor:pointer;
      transition: transform .08s ease;
      box-shadow: 0 8px 20px rgba(0,0,0,.10);
    }
    button:active{ transform: scale(.98); }
    .primary{
      background: var(--pink);
      color:white;
    }
    .ghost{
      background:#e6e6e6;
      color:#333;
    }

    .topbar{
      position:absolute;
      top:16px;
      right:16px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .chip{
      background:#ffffffd9;
      border-radius:999px;
      padding:8px 12px;
      box-shadow:var(--shadow);
      font-size:14px;
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .chip button{
      padding:6px 10px;
      font-size:14px;
      border-radius:999px;
      box-shadow:none;
    }

    .slideshow{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:18px;
      align-items:center;
    }
    .slideFrame{
      width:100%;
      aspect-ratio: 4 / 3;
      background:#fff;
      border-radius:18px;
      overflow:hidden;
      box-shadow:var(--shadow);
      position:relative;
    }
    .slideFrame img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .caption{
      font-size:16px;
      opacity:.9;
      margin-top:10px;
      text-align:center;
    }
    @media (max-width: 820px){
      .slideshow{ grid-template-columns: 1fr; }
    }

    .begRow{
      display:flex;
      gap:14px;
      justify-content:center;
      flex-wrap:wrap;
      margin:16px 0;
    }
    .begRow img{
      width:min(180px, 40vw);
      border-radius:18px;
      box-shadow:var(--shadow);
      background:#fff;
    }

    .noZone{
      position:relative;
      height:120px;
      margin-top:8px;
    }
    #noBtn{
      position:absolute;
      left:50%;
      top:10px;
      transform: translateX(-50%);
    }
    #yesBtn{
      position:absolute;
      left:50%;
      top:66px;
      transform: translateX(-50%);
    }

    #confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      display:none;
    }

    .heart{
      position:fixed;
      width:18px;
      height:18px;
      background: rgba(255,77,136,.25);
      transform: rotate(45deg);
      border-radius:3px;
      pointer-events:none;
      animation: floatUp linear forwards;
    }
    .heart::before, .heart::after{
      content:"";
      position:absolute;
      width:18px;
      height:18px;
      background: rgba(255,77,136,.25);
      border-radius:50%;
    }
    .heart::before{ left:-9px; top:0; }
    .heart::after{ left:0; top:-9px; }
    @keyframes floatUp{
      from{ transform: translateY(0) rotate(45deg); opacity:.7; }
      to{ transform: translateY(-110vh) rotate(45deg); opacity:0; }
    }

    .finalPhoto{
      width:min(520px, 86vw);
      aspect-ratio: 4 / 3;
      margin: 14px auto 10px auto;
      border-radius:18px;
      overflow:hidden;
      box-shadow:var(--shadow);
      background:#fff;
    }
    .finalPhoto img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .hidden{ display:none; }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <!-- audio -->
  <audio id="bgMusic" src="assets/audio/music.mp3" loop></audio>
  <audio id="drumroll" src="assets/audio/drumroll.mp3" loop></audio>
  <audio id="fireworks" src="assets/audio/fireworks.mp3"></audio>

  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div class="chip">
          üéµ Music
          <button id="musicBtn" class="ghost" type="button">Play</button>
        </div>
      </div>

      <!-- PAGE 1 -->
      <section id="page1" class="center">
        <h1>Can I ask you a question?</h1>
        <p>Just one‚Ä¶</p>
        <div class="btnRow">
          <button class="primary" id="p1Yes" type="button">YES! üíñ</button>
        </div>
      </section>

      <!-- PAGE 2 -->
      <section id="page2" class="hidden">
        <div class="slideshow">
          <div>
            <div class="slideFrame">
              <img id="slideImg" alt="us being silly" src="assets/photos/1.jpeg"/>
            </div>
            <div class="caption" id="slideCaption">memory 1 ‚ù§Ô∏è</div>
            <div class="btnRow">
              <button class="ghost" id="prevSlide" type="button">‚¨ÖÔ∏è</button>
              <button class="primary" id="nextSlide" type="button">Next ‚û°Ô∏è</button>
            </div>
          </div>
          <div class="center">
            <h1>Look at us ü•π</h1>
            <p>
              After <b>1 year and 4 months</b> of the happiest time of my life,
              I got a lil question for you‚Ä¶
            </p>
            <div class="btnRow">
              <button class="primary" id="toQuestion" type="button">I‚Äôm ready üò≥</button>
            </div>
          </div>
        </div>
      </section>

      <!-- PAGE 3 -->
      <section id="page3" class="hidden center">
        <h1>Will you be my Valentine, my love? üíò</h1>

        <div class="begRow">
          <img src="assets/gifs/beg1.png" alt="begging silly blue guy 1">
          <img src="assets/gifs/beg2.png" alt="begging silly blue guy 2">
        </div>

        <p>(Choose wisely üòá)</p>

        <div class="noZone">
          <button id="noBtn" class="ghost" type="button">No üò¢</button>
          <button id="yesBtn" class="primary" type="button">Yes üíò</button>
        </div>
      </section>

      <!-- PAGE 4 -->
      <section id="page4" class="hidden center">
        <h1>YEAHHHHHH!!! üéÜüíñüéâ</h1>

        <div class="finalPhoto">
          <img id="finalImg" src="assets/photos/final.jpeg" alt="us ‚ù§Ô∏è">
        </div>

        <p>
          You just made me the happiest person alive üò≠‚ù§Ô∏è<br/>
          I love you so much.
        </p>
        <p style="font-size:22px">ü•≥üòçüòöüíû‚ú®ü•∞üéá</p>
        <div class="btnRow">
          <button class="primary" id="replay" type="button">Reset üí´</button>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ---------------------------
    // CONFIG: slides + final photo
    // ---------------------------
    const slides = [
      { src: "assets/photos/1.jpeg", caption: "memory 1 ‚ù§Ô∏è" },
      { src: "assets/photos/2.jpeg", caption: "memory 2 üòÇ" },
      { src: "assets/photos/3.jpeg", caption: "memory 3 ü•π" },
      { src: "assets/photos/4.jpeg", caption: "memory 4 üíï" },
    ];

    const finalPhotoSrc = "assets/photos/final.jpeg";
    document.getElementById("finalImg").src = finalPhotoSrc;

    // ---------------------------
    // Page navigation
    // ---------------------------
    const page1 = document.getElementById("page1");
    const page2 = document.getElementById("page2");
    const page3 = document.getElementById("page3");
    const page4 = document.getElementById("page4");

    function showPage(p){
      [page1,page2,page3,page4].forEach(x => x.classList.add("hidden"));
      p.classList.remove("hidden");
    }

    // ---------------------------
    // Audio control
    // ---------------------------
    const musicBtn = document.getElementById("musicBtn");
    const bgMusic = document.getElementById("bgMusic");
    const drumroll = document.getElementById("drumroll");
    const fireworks = document.getElementById("fireworks");

    let musicOn = false;

    function stopAllAudio() {
      [bgMusic, drumroll, fireworks].forEach(a => {
        a.pause();
        a.currentTime = 0;
      });
    }

    async function playBgMusicIfEnabled() {
      if (!musicOn) return;
      try {
        bgMusic.volume = 0.6;
        await bgMusic.play();
      } catch (e) { /* autoplay block */ }
    }

    async function playDrumroll() {
      try {
        bgMusic.pause();
        bgMusic.currentTime = 0;
        drumroll.currentTime = 0;
        drumroll.volume = 0.85;
        await drumroll.play();
      } catch (e) { /* autoplay block */ }
    }

    async function playFireworksOnly() {
      try {
        bgMusic.pause(); bgMusic.currentTime = 0;
        drumroll.pause(); drumroll.currentTime = 0;

        fireworks.currentTime = 0;
        fireworks.volume = 1.0;
        await fireworks.play();
      } catch (e) { /* autoplay block */ }
    }

    // Music button toggles ONLY background music
    musicBtn.addEventListener("click", () => {
      if (!musicOn) {
        bgMusic.volume = 0.6;
        bgMusic.play().then(() => {
          musicOn = true;
          musicBtn.textContent = "Pause";
        }).catch(() => {
          alert("Click anywhere on the page once, then press Play again üôÇ");
        });
      } else {
        bgMusic.pause();
        musicOn = false;
        musicBtn.textContent = "Play";
      }
    });

    // ---------------------------
    // Slideshow
    // ---------------------------
    let idx = 0;
    const slideImg = document.getElementById("slideImg");
    const slideCaption = document.getElementById("slideCaption");

    function renderSlide(){
      slideImg.src = slides[idx].src;
      slideCaption.textContent = slides[idx].caption;
    }
    renderSlide();

    document.getElementById("prevSlide").addEventListener("click", () => {
      idx = (idx - 1 + slides.length) % slides.length;
      renderSlide();
    });

    document.getElementById("nextSlide").addEventListener("click", () => {
      idx = (idx + 1) % slides.length;
      renderSlide();
    });

    // ---------------------------
    // Start / transitions
    // ---------------------------
    document.getElementById("p1Yes").addEventListener("click", async () => {
      showPage(page2);
      // if user had music on, keep it going
      await playBgMusicIfEnabled();
    });

    document.getElementById("toQuestion").addEventListener("click", async () => {
      showPage(page3);
      await playDrumroll(); // cuts bg music + loops drumroll here
    });

    // ---------------------------
    // NO button runaway
    // ---------------------------
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");
    const zone = document.querySelector(".noZone");

    function moveNo(){
      const zoneRect = zone.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();

      const maxX = zoneRect.width - btnRect.width;
      const maxY = zoneRect.height - btnRect.height;

      const x = Math.max(0, Math.random() * maxX);
      const y = Math.max(0, Math.random() * (maxY * 0.55)); // mostly above YES

      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
      noBtn.style.transform = "none";
      noBtn.style.position = "absolute";
    }

    noBtn.addEventListener("mouseenter", moveNo);
    noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); moveNo(); }, {passive:false});

    // ---------------------------
    // Confetti
    // ---------------------------
    const confettiCanvas = document.getElementById("confetti");
    const ctx = confettiCanvas.getContext("2d");

    function resizeCanvas(){
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    let confettiPieces = [];
    let confettiOn = false;

    function startConfetti(){
      confettiCanvas.style.display = "block";
      confettiOn = true;
      confettiPieces = Array.from({length: 220}).map(() => ({
        x: Math.random()*confettiCanvas.width,
        y: -20 - Math.random()*confettiCanvas.height,
        r: 4 + Math.random()*6,
        vx: -2 + Math.random()*4,
        vy: 2 + Math.random()*5,
        rot: Math.random()*Math.PI,
        vr: -0.2 + Math.random()*0.4,
      }));
      requestAnimationFrame(tickConfetti);
    }

    function tickConfetti(){
      if(!confettiOn) return;
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      for(const p of confettiPieces){
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        if(p.y > confettiCanvas.height + 30) {
          p.y = -30;
          p.x = Math.random()*confettiCanvas.width;
        }
        if(p.x < -30) p.x = confettiCanvas.width + 30;
        if(p.x > confettiCanvas.width + 30) p.x = -30;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r);
        ctx.restore();
      }
      requestAnimationFrame(tickConfetti);
    }

    // Floating hearts background
    function makeHearts(){
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.style.left = Math.random()*window.innerWidth + "px";
      heart.style.bottom = "-20px";
      const dur = 4 + Math.random()*4;
      heart.style.animationDuration = dur + "s";
      heart.style.opacity = 0.25 + Math.random()*0.5;
      const size = 10 + Math.random()*18;
      heart.style.width = size + "px";
      heart.style.height = size + "px";
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), dur*1000);
    }
    setInterval(makeHearts, 450);

    // ---------------------------
    // YES -> final celebration (no bg music)
    // ---------------------------
    yesBtn.addEventListener("click", async () => {
      showPage(page4);
      startConfetti();
      await playFireworksOnly(); // stops drumroll + bg, plays fireworks
    });

    // ---------------------------
    // Reset -> stop celebration and restart bg music (if enabled)
    // ---------------------------
    document.getElementById("replay").addEventListener("click", async () => {
      confettiOn = false;
      confettiCanvas.style.display = "none";

      // stop celebration audio, restart bg music if user wants
      drumroll.pause(); drumroll.currentTime = 0;
      fireworks.pause(); fireworks.currentTime = 0;

      idx = 0;
      renderSlide();
      showPage(page1);

      await playBgMusicIfEnabled();
    });
  </script>
</body>
</html>
